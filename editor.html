<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flowchart Builder</title>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; background: #181818; color: white; display: flex; }
        .sidebar { width: 200px; background: #222; padding: 10px; }
        .flowchart-container { flex: 1; height: 100vh; position: relative; overflow: hidden; }
        button { width: 100%; margin-bottom: 5px; padding: 8px; background: #444; border: none; color: white; cursor: pointer; }
        button:hover { background: #666; }
        .node { position: absolute; padding: 10px; background: gray; color: white; border-radius: 5px; cursor: move; display: flex; align-items: center; }
        .node input { border: none; background: transparent; color: white; font-size: 14px; width: 80px; text-align: center; }
        .node input:focus { outline: none; border-bottom: 1px solid white; }
        .delete-btn { background: red; color: white; border: none; cursor: pointer; padding: 3px; position: absolute; top: 5px; right: 5px; display: none; }
        .node:hover .delete-btn { display: inline; }
    </style>
</head>
<body>
    <div class="sidebar">
        <button onclick="addNode('Supplier')">Add Supplier</button>
        <button onclick="addNode('Warehouse')">Add Warehouse</button>
        <button onclick="addNode('Transport')">Add Transport</button>
        <button onclick="addNode('Distribution')">Add Distribution</button>
        <button onclick="addNode('Retail')">Add Retail</button>
        <button onclick="undo()">Undo</button>
        <button onclick="redo()">Redo</button>
        <button onclick="exportAsImage()">Export as Image</button>
        <button onclick="exportAsPDF()">Export as PDF</button>
    </div>
    <div class="flowchart-container" id="flowchart"></div>

    <script>
        let nodeCount = 0;
        let history = [];
        let redoStack = [];
        
        function addNode(type) {
            const canvas = document.getElementById("canvas");
            const node = document.createElement("div");
            node.classList.add("node");
            node.innerText = type;
            node.id = `node-${nodeCounter++}`;
            const leftPosition = 50 + (nodeCounter * 120); // Increment node position for better layout
            const topPosition = 50 + (nodeCounter * 50);  // Avoid nodes overlapping
            node.style.left = `${leftPosition}px`;
            node.style.top = `${topPosition}px`;

            // Create input for node name (editable)
            const input = document.createElement("input");
            input.value = `${type}${nodeCount}`;
            input.onblur = () => saveState();
            node.appendChild(input);
            
            // Create color picker for the specific node
            const colorPicker = document.createElement("input");
            colorPicker.type = "color";
            colorPicker.oninput = (event) => {
                node.style.backgroundColor = event.target.value;
            };
            node.appendChild(colorPicker);
            
            const deleteBtn = document.createElement("button");
            deleteBtn.innerText = "x";
            deleteBtn.classList.add("delete");
            deleteBtn.onclick = () => { node.remove(); saveState(); };
            node.appendChild(deleteBtn);
                };
            };
            
            node.ondragstart = () => false;
            flowchart.appendChild(node);
            saveState();
        }
        
        function saveState() {
            history.push(document.getElementById("flowchart").innerHTML);
            redoStack = [];
        }

        function makeDraggable(element) {
            interact(element).draggable({
                listeners: {
                    move(event) {
                        let target = event.target;
                        let x = (parseFloat(target.getAttribute("data-x")) || 0) + event.dx;
                        let y = (parseFloat(target.getAttribute("data-y")) || 0) + event.dy;
                        target.style.transform = `translate(${x}px, ${y}px)`;
                        target.setAttribute("data-x", x);
                        target.setAttribute("data-y", y);
                    },
                    end() { saveState(); }
                }
            });
        }

        function saveState() {
            history.push(document.getElementById("canvas").innerHTML);
            redoStack = [];
        }

        function undo() {
            if (history.length > 1) {
                redoStack.push(history.pop());
                document.getElementById("flowchart").innerHTML = history[history.length - 1];
            }
        }
        
        function redo() {
            if (redoStack.length > 0) {
                history.push(redoStack.pop());
                document.getElementById("flowchart").innerHTML = history[history.length - 1];
            }
        }
        
        function exportAsImage() {
            html2canvas(document.getElementById("flowchart")).then(canvas => {
                let link = document.createElement('a');
                link.download = 'flowchart.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        }
        
        function exportAsPDF() {
            html2canvas(document.getElementById("flowchart")).then(canvas => {
                let imgData = canvas.toDataURL('image/png');
                let pdf = new jsPDF('landscape');
                pdf.addImage(imgData, 'PNG', 10, 10);
                pdf.save('flowchart.pdf');
            });
        }
        
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</body>
</html>
