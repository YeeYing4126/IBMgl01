<!DOCTYPE html>
<html>
<head>
    <title>Mermaid‚Äôs Marina Delivery Dive</title>
    <style>
        canvas {
            border: 2px solid #1a5c7a;
            background: #0a2f4e;
        }
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: "Segoe UI", sans-serif;
            background: #083358;
            color: white;
            margin: 0;
        }
        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        .background {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
        }
        h1 {
            font-size: 2rem;
            color: #00796b;
        }
        .hazard-warning {
            animation: flash 0.5s infinite;
            color: red;
        }
        @keyframes flash {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        .particle {
            position: absolute;
            pointer-events: none;
            user-select: none;
        }
        #scoreboard {
            font-size: 1.5rem;
            margin: 20px;
        }
        #gameMessage {
            font-size: 1.2rem;
            color: green;
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 1rem;
            margin: 10px;
            border: none;
            background-color: #4db6ac;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #00897b;
        }
        .location {
            position: absolute;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid #fff;
            color: white;
            padding: 5px 10px;
            border-radius: 10px;
            font-weight: bold;
        }
        .surface-post { top: 15%; left: 60%; }
        .coral-reef { top: 45%; right: 25%; }
        .sunken-ship { top: 40%; left: 20%; }
        .home-cave { bottom: 10%; left: 30%; }
        .mermaid {
            position: absolute;
            bottom: 12%;
            left: 32%;
            width: 40px;
            height: 60px;
            background: url('your-mermaid-image.png') no-repeat center;
            background-size: contain;
        }
        .info-card {
            position: absolute;
            top: 80px;
            left: 20px;
            background: rgba(255, 250, 240, 0.95);
            padding: 10px 15px;
            border-radius: 10px;
            border: 2px solid #000;
        }
        .info-card .hazard {
            color: red;
            font-weight: bold;
        }
        .validate-button {
            position: absolute;
            bottom: 50px;
            right: 50px;
            padding: 10px 20px;
            font-size: 18px;
            border: none;
            background: #00b4d8;
            color: white;
            border-radius: 12px;
            cursor: pointer;
        }
        .energy-used {
            position: absolute;
            bottom: 20px;
            right: 50px;
            color: white;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>üêö Mermaid‚Äôs Marina Delivery Dive üê†</h1>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="feedback" style="margin-top: 20px;"></div>
    <div id="energy">Energy: 20</div>
    <div id="scoreboard">
        Score: <span id="score">0</span> | High Score: <span id="highScore">0</span>
  </div>
    
    <button onclick="startGame()">Start Game</button>
    <button onclick="resetGame()">Reset</button>

    <div id="gameMessage"></div>
    
    <audio id="bgMusic" loop>
        <source src="Background Music.mp3" type="audio/mpeg">
    </audio>
    <audio id="hazardSound">
        <source src="Hazard Sound.mp3" type="audio/mpeg">
    </audio>
    <audio id="successSound">
        <source src="Success Sound.mp3" type="audio/mpeg">
    </audio>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const feedbackDiv = document.getElementById('feedback');
const energyDiv = document.getElementById('energy');
const scoreSpan = document.getElementById('score');
const highScoreSpan = document.getElementById('highScore');
const bgMusic = document.getElementById('bgMusic');
const hazardSound = document.getElementById('hazardSound');
const successSound = document.getElementById('successSound');

// Game state
let selectedNodes = [];
let currentEnergy = 20;
let score = 0;
let highScore = localStorage.getItem('highScore') || 0;
let gameRunning = false;
let startTime = Date.now();

// Nodes (name: [x, y])
const nodes = {
    "Home Cave": [400, 500],
    "Surface Trading Post": [200, 100],
    "Sunken Ship": [600, 150],
    "Coral Reef": [300, 300],
    "Abandoned Cave": [500, 400]
};

// Paths: [node1, node2, cost, hazard]
const paths = [
    ["Home Cave", "Coral Reef", 3, null],
    ["Coral Reef", "Surface Trading Post", 4, null],
    ["Surface Trading Post", "Sunken Ship", 5, "shark"],
    ["Sunken Ship", "Abandoned Cave", 2, null],
    ["Abandoned Cave", "Home Cave", 6, "dark"]
];

// Particle System
class Particle {
    constructor(x, y, type) {
        this.x = x;
        this.y = y;
        this.vx = Math.random() * 4 - 2;
        this.vy = Math.random() * -3 - 2;
        this.life = 1;
        this.type = type;
        this.element = document.createElement('div');
        this.element.className = 'particle';
        
        if(this.type === 'shark') {
            this.element.textContent = 'ü¶à';
            this.element.style.fontSize = '24px';
        } else {
            this.element.textContent = 'üíß';
            this.element.style.color = '#00B7EB';
        }
        
        document.body.appendChild(this.element);
    }

    update() {
        this.life -= 0.02;
        this.x += this.vx;
        this.y += this.vy;
        this.element.style.transform = `translate(${this.x}px, ${this.y}px)`;
        this.element.style.opacity = this.life;
        
        if(this.life <= 0) {
            this.element.remove();
            return false;
        }
        return true;
    }
}

let particles = [];

function createHazardEffect(x, y, type) {
    for(let i = 0; i < 15; i++) {
        particles.push(new Particle(x, y, type));
    }
}

function updateParticles() {
    particles = particles.filter(p => p.update());
}

function drawNode(name, x, y, isSelected) {
    ctx.beginPath();
    ctx.arc(x, y, 20, 0, Math.PI * 2);
    ctx.fillStyle = isSelected ? "#4CAF50" : "#2196F3";
    ctx.fill();
    ctx.fillStyle = "white";
    ctx.font = "14px Arial";
    ctx.fillText(name, x - 40, y + 35);
}

function drawPath(x1, y1, x2, y2, cost) {
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.strokeStyle = "#FFFFFF";
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.fillStyle = "#FF5252";
    ctx.fillText(cost, (x1 + x2)/2, (y1 + y2)/2);
}

function drawSelectedRoute() {
    ctx.setLineDash([5, 5]);
    ctx.strokeStyle = "#FFEB3B";
    ctx.lineWidth = 3;
    ctx.beginPath();
    for(let i=0; i<selectedNodes.length-1; i++) {
        const start = nodes[selectedNodes[i]];
        const end = nodes[selectedNodes[i+1]];
        ctx.moveTo(start[0], start[1]);
        ctx.lineTo(end[0], end[1]);
    }
    ctx.stroke();
    ctx.setLineDash([]);
}

function startGame() {
    selectedNodes = [];
    currentEnergy = 20;
    startTime = Date.now();
    energyDiv.textContent = `Energy: ${currentEnergy}`;
    score = 0;
    scoreSpan.textContent = '0';
    gameRunning = true;
    feedbackDiv.textContent = "Game started! Click nodes to plan your route";
    bgMusic.play();
    draw();
}

function resetGame() {
    gameRunning = false;
    selectedNodes = [];
    currentEnergy = 20;
    score = 0;
    energyDiv.textContent = `Energy: ${currentEnergy}`;
    scoreSpan.textContent = '0';
    feedbackDiv.textContent = "";
    bgMusic.pause();
    bgMusic.currentTime = 0;
    draw();
}
    
function validateRoute() {
    if (selectedNodes.length < 2) return "Route too short!";
    
    // Check start/end at Home Cave
    const validStartEnd = selectedNodes[0] === "Home Cave" && 
                         selectedNodes[selectedNodes.length-1] === "Home Cave";
    
    // Check all nodes visited (excluding duplicate Home Cave)
    const requiredNodes = Object.keys(nodes).filter(n => n !== "Home Cave");
    const allVisited = requiredNodes.every(node => selectedNodes.includes(node));
    
    if (!validStartEnd) return "Must start/end at Home Cave! üè†";
    if (!allVisited) return "Missed some locations!";
    
    // Calculate score
    const timeElapsed = Math.floor((Date.now() - startTime) / 1000);
    score = Math.max(0, (1000 - (currentEnergy * 10)) + (500 - timeElapsed * 20));
    
    if (score > highScore) {
        highScore = score;
        localStorage.setItem('highScore', highScore);
        highScoreSpan.textContent = highScore;
    }
    
    successSound.play();
    gameRunning = false;
    return `Success! üéâ Score: ${score}`;
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    updateParticles();

    // Draw paths
    paths.forEach(([n1, n2, cost]) => drawPath(...nodes[n1], ...nodes[n2], cost));
    
    // Draw selected route
    if (selectedNodes.length >= 2) drawSelectedRoute();
    
    // Draw nodes
    Object.entries(nodes).forEach(([name, [x, y]]) => 
        drawNode(name, x, y, selectedNodes.includes(name)));
    
    // Draw mermaid
    if (selectedNodes.length > 0) {
        const [x, y] = nodes[selectedNodes[selectedNodes.length - 1]];
        ctx.fillStyle = "#FF69B4";
        ctx.font = "24px Arial";
        ctx.fillText("üßú‚ôÄÔ∏è", x - 15, y - 30);
    }
}

canvas.addEventListener('click', (e) => {
    if (!gameRunning) return;
    
    const rect = canvas.getBoundingClientRect();
    const mouseX = e.clientX - rect.left;
    const mouseY = e.clientY - rect.top;

    Object.entries(nodes).forEach(([name, [x, y]]) => {
        if (Math.hypot(mouseX - x, mouseY - y) < 20) {
            if (selectedNodes.length === 0 && name !== "Home Cave") {
                feedbackDiv.textContent = "Must start at Home Cave!";
                return;
            }
            
            if (selectedNodes.includes(name) && name !== "Home Cave") {
                feedbackDiv.textContent = "Already visited this location!";
                return;
            }

            if (selectedNodes.length > 0) {
                const lastNode = selectedNodes[selectedNodes.length - 1];
                const path = paths.find(p => 
                    (p[0] === lastNode && p[1] === name) || 
                    (p[1] === lastNode && p[0] === name)
                );

                if (!path) {
                    feedbackDiv.textContent = "‚ö†Ô∏è No path exists! ‚ö†Ô∏è";
                    return;
                }

                const cost = path[2];
                if (currentEnergy < cost) {
                    feedbackDiv.innerHTML = `<span class="hazard-warning">Not enough energy!</span>`;
                    return;
                }

                currentEnergy -= cost;
                energyDiv.textContent = `Energy: ${currentEnergy}`;

                if (path[3]) {
                    feedbackDiv.innerHTML = `<span class="hazard-warning">‚ö†Ô∏è ${path[3].toUpperCase()} hazard!</span>`;
                    hazardSound.play();
                    createHazardEffect(x, y, path[3]);
                }
            }

            selectedNodes.push(name);
            feedbackDiv.textContent = `Route: ${selectedNodes.join(" ‚Üí ")}`;
            
            if (name === "Home Cave" && selectedNodes.length > 1) {
                const result = validateRoute();
                feedbackDiv.textContent = result;
                gameRunning = false;
                if (result.startsWith("Success")) {
                    scoreSpan.textContent = score;
                    if (score > highScore) {
                        highScoreSpan.textContent = score;
                    }
                }
            }
            
            draw();
        }
    });
});

highScoreSpan.textContent = highScore;
draw();
</script>
    
<p>How to play:</p>
<ul>
    <li>Click nodes to build your route</li>
    <li>Press ENTER to validate</li>
    <li>Must visit all nodes and return to Home Cave!</li>
    <li>Energy decreases with each move</li>
</ul>
</body>
</html>
